<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Commander Tracker</title>

    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, setDoc, getDocs, updateDoc, onSnapshot, doc, increment, serverTimestamp, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        window.startFirebase = async () => {
            try {
                const config = { apiKey: "AIzaSyC8sMzkkeF-6aBxi8n406hqD8-N0mAC-00", authDomain: "commandertracker-5b4c5.firebaseapp.com", projectId: "commandertracker-5b4c5", storageBucket: "commandertracker-5b4c5.firebasestorage.app", messagingSenderId: "591105293707", appId: "1:591105293707:web:d0dc9da4caf484c941c38e", measurementId: "G-6WZSTXS55D" };
                const app = initializeApp(config);
                window.db = getFirestore(app);
                window.dbMethods = { collection, addDoc, setDoc, getDocs, updateDoc, onSnapshot, doc, increment, serverTimestamp, query, orderBy, limit };
                window.isOnline = true;
            } catch (e) { window.isOnline = false; }
        };
        window.startFirebase();
    </script>

    <style>
        /* --- CORE RESET --- */
        :root {
            --bg: #050505;
            --panel: #151515;
            --border: rgba(255,255,255,0.15);
            --accent: #3b82f6;
            --text: #e5e5e5;
            --danger: #ef4444;
            --success: #22c55e;
            --gold: #eab308;
            --glass: rgba(255, 255, 255, 0.08);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; font-family: 'Chakra Petch', sans-serif; }

        body {
            margin: 0; padding: 0;
            background: #000; color: var(--text);
            height: 100dvh; width: 100vw;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        /* --- APP CONTAINER (The "Tabletop") --- */
        #app {
            width: 100%; height: 100%;
            position: relative;
            background: var(--bg);
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* PC MODE: Restrain width, add margins, make it look like an app */
        @media (min-width: 1024px) {
            #app {
                max-width: 1200px;
                height: 95vh;
                border: 1px solid var(--border);
                border-radius: 24px;
                box-shadow: 0 0 60px rgba(0,0,0,0.8);
            }
            body { background: #111; }
        }

        /* SCREENS */
        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            background: var(--bg); z-index: 10;
        }

        .hidden { display: none !important; }

        /* --- SETUP SCREEN --- */
        #setup-view {
            z-index: 100;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            align-items: center;
        }

        .setup-wrapper {
            width: 100%; max-width: 500px;
            display: flex; flex-direction: column; gap: 15px;
            padding-bottom: 50px;
        }

        .card {
            background: var(--panel); border: 1px solid var(--border);
            border-radius: 16px; padding: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .row { display: flex; gap: 10px; align-items: center; }

        input {
            background: #000; border: 1px solid #444; color: white;
            padding: 12px; border-radius: 10px; flex: 1; outline: none; font-size: 1rem;
            transition: border-color 0.2s;
        }
        input:focus { border-color: var(--accent); }

        button {
            background: var(--accent); color: white; border: none;
            padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer;
            transition: all 0.1s; font-size: 0.9rem;
        }
        button:active { transform: scale(0.96); opacity: 0.9; }
        button.secondary { background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid transparent; }
        button.active { background: var(--accent); color: white; border: 2px solid rgba(255,255,255,0.5); box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }

        /* --- GAME BOARD --- */
        #game-view { z-index: 50; }

        #game-grid {
            display: flex; flex-direction: column;
            width: 100%; height: 100%;
        }

        .player-row {
            display: flex; flex: 1;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .player-row:last-child { border-bottom: none; }

        .seat {
            flex: 1; position: relative;
            border-right: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background-size: cover; background-position: center;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .seat:last-child { border-right: none; }

        /* Rotations for Opponents */
        .player-row:first-child .seat { transform: rotate(180deg); }

        .seat-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); z-index: 1; backdrop-filter: blur(2px); }
        .seat-ui { position: relative; z-index: 2; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 1vh; }

        /* LIFE & CONTROLS */
        .life-group { display: flex; align-items: center; gap: 5vw; }

        .life-btn {
            width: clamp(40px, 8vw, 60px); height: clamp(40px, 8vw, 60px); border-radius: 50%;
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            font-size: 2rem; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(10px); cursor: pointer;
        }
        .life-btn:active { background: rgba(255,255,255,0.2); }

        .life-total {
            font-size: clamp(4rem, 15vw, 8rem);
            font-weight: 700; line-height: 1;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .life-total.danger { color: var(--danger); text-shadow: 0 0 20px rgba(239, 68, 68, 0.6); }

        .name-tag {
            background: rgba(0,0,0,0.6); padding: 6px 12px; border-radius: 20px;
            font-size: 0.9rem; max-width: 80%;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(4px);
            text-shadow: 1px 1px 0 #000;
        }

        .tools { display: flex; gap: 10px; margin-top: 10px; }
        .tool {
            width: clamp(36px, 7vw, 44px); height: clamp(36px, 7vw, 44px);
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; position: relative; cursor: pointer;
            backdrop-filter: blur(5px);
        }
        .counter {
            position: absolute; top: -6px; right: -6px;
            background: var(--success); color: black;
            font-size: 0.7rem; font-weight: bold;
            width: 18px; height: 18px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* CENTER MENU */
        #center-menu {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 90; display: flex; flex-direction: column; gap: 10px;
        }
        .menu-btn {
            width: 50px; height: 50px; border-radius: 50%;
            background: #111; border: 2px solid #444;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8);
            font-size: 0.7rem; font-weight: bold; color: #ccc;
            cursor: pointer; transition: transform 0.1s;
        }
        .menu-btn:active { transform: translate(-50%, -50%) scale(0.9); }
        .menu-btn.roll { background: #7c3aed; border-color: #a78bfa; color: white; box-shadow: 0 0 20px rgba(124, 58, 237, 0.5); }

        /* MODALS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 200; display: none; align-items: center; justify-content: center; }
        .active { display: flex !important; }
        .modal-box { width: 90%; max-width: 400px; background: #1a1a1a; padding: 25px; border-radius: 20px; border: 1px solid #444; text-align: center; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }

        .glow-active {
            box-shadow: inset 0 0 0 4px var(--gold), inset 0 0 50px rgba(234, 179, 8, 0.3) !important;
            border-color: var(--gold) !important;
        }
    </style>
</head>
<body>

    <div id="app">

        <div id="setup-view" class="screen">
            <div class="setup-wrapper">
                <h1 style="text-align:center; color:var(--accent); margin:10px 0 0; font-size: 2.5rem; text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);">Commander</h1>
                <div style="text-align:center; color:#666; font-size:0.7rem; margin-bottom:20px;">v1.1.2 (Visuals + Fixes)</div>

                <div class="card row" style="background: rgba(255,255,255,0.05);">
                    <span style="font-size:0.7rem; font-weight:bold; color:#888;">GROUP</span>
                    <input id="group-input" type="text" value="default" style="margin:0; background: transparent; border: none; font-size: 1.1rem; text-align: right;">
                    <button class="secondary" style="width:auto; margin:0;" onclick="loadGroup()">LOAD</button>
                </div>

                <div style="display:flex; gap:10px;">
                    <button id="btn-p2" class="secondary" style="flex:1" onclick="setPlayers(2)">2 Players</button>
                    <button id="btn-p3" class="secondary" style="flex:1" onclick="setPlayers(3)">3 Players</button>
                    <button id="btn-p4" class="active" style="flex:1" onclick="setPlayers(4)">4 Players</button>
                </div>

                <div id="seats-list" style="display:flex; flex-direction:column; gap:12px;"></div>

                <button style="background: linear-gradient(135deg, #16a34a, #15803d); font-size:1.2rem; padding:18px; box-shadow: 0 5px 20px rgba(22, 163, 74, 0.4);" onclick="launchGame()">START GAME</button>

                <div style="text-align:center; margin-top:15px;">
                    <a href="#" onclick="showStats()" style="color:#666; font-size:0.8rem; text-decoration: none; border-bottom: 1px dotted #444;">View Stats</a>
                </div>
            </div>
        </div>

        <div id="game-view" class="screen hidden">
            <div id="game-grid"></div>
            <div id="center-menu">
                <button class="menu-btn roll" onclick="rollFirst()">ROLL</button>
                <button class="menu-btn" onclick="checkEnd()">END</button>
            </div>
        </div>

        <div id="modal-search" class="modal">
            <div class="modal-box">
                <h3 style="color:white; margin-top:0;">Select Card</h3>
                <input id="search-bar" type="text" placeholder="Start typing..." oninput="onSearchInput(this.value)" style="background:#111; border-color:#333;">
                <div id="search-results" style="text-align:left; display:flex; flex-direction:column; gap:5px; margin-top:10px;"></div>
                <button class="secondary" style="width:100%; margin-top:15px;" onclick="closeModal('modal-search')">Cancel</button>
            </div>
        </div>

        <div id="modal-stats" class="modal">
            <div class="modal-box">
                <h3 style="color:var(--accent); margin-top:0;">Match History</h3>
                <div id="history-log" style="text-align:left; font-size:0.8rem; display:flex; flex-direction:column; gap:10px; margin:20px 0;">Loading...</div>
                <button class="secondary" style="width:100%;" onclick="closeModal('modal-stats')">Close</button>
            </div>
        </div>

        <div id="modal-win" class="modal">
            <div class="modal-box">
                <h2 id="winner-name" style="color:white; font-size:1.8rem; margin:0 0 5px 0;">Winner</h2>
                <p style="color:#666; margin:0 0 20px 0; font-size:0.8rem;">HOW DID THEY WIN?</p>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <button class="secondary" onclick="saveWin('Combat')">‚öîÔ∏è Combat</button>
                    <button class="secondary" onclick="saveWin('Cmd Dmg')">üõ°Ô∏è Cmd Dmg</button>
                    <button class="secondary" onclick="saveWin('Infinite')">‚ôæÔ∏è Infinite</button>
                    <button class="secondary" onclick="saveWin('Poison')">‚ò†Ô∏è Poison</button>
                    <button class="secondary" onclick="saveWin('Alt Win')">üîÆ Alt Win</button>
                    <button class="secondary" onclick="saveWin('Conceded')">üè≥Ô∏è Conceded</button>
                </div>
                <button style="width:100%; margin-top:15px; background:transparent; color:#666;" onclick="closeModal('modal-win')">Cancel</button>
            </div>
        </div>

    </div>

    <script>
        let state = {
            group: localStorage.getItem('group') || 'default',
            playerCount: 4,
            players: [
                { id:1, name:"Seat 1", life:40, poison:0, cast:0, active:true, cmd:"", part:"", img:"" },
                { id:2, name:"Seat 2", life:40, poison:0, cast:0, active:true, cmd:"", part:"", img:"" },
                { id:3, name:"Seat 3", life:40, poison:0, cast:0, active:true, cmd:"", part:"", img:"" },
                { id:4, name:"Seat 4", life:40, poison:0, cast:0, active:true, cmd:"", part:"", img:"" }
            ],
            searchTarget: null,
            searchIsPartner: false,
            winner: null
        };
        let searchTimer = null;

        document.getElementById('group-input').value = state.group;
        renderSeats();

        function loadGroup() {
            state.group = document.getElementById('group-input').value;
            localStorage.setItem('group', state.group);
            alert("Group Set: " + state.group);
        }

        function setPlayers(n) {
            state.playerCount = n;
            [2,3,4].forEach(i => {
                const btn = document.getElementById(`btn-p${i}`);
                if(i===n) btn.className = 'active';
                else btn.className = 'secondary';
            });
            state.players.forEach(p => p.active = false);
            if(n===4) state.players.forEach(p => p.active = true);
            else if(n===3) { state.players[0].active=true; state.players[1].active=true; state.players[2].active=true; }
            else { state.players[0].active=true; state.players[2].active=true; } // 1v1 Split
            renderSeats();
        }

        function renderSeats() {
            const list = document.getElementById('seats-list');
            list.innerHTML = '';
            state.players.forEach(p => {
                if(!p.active) return;
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="row" style="margin-bottom:8px; justify-content:space-between;">
                        <span style="font-size:0.7rem; font-weight:bold; color:#555;">SEAT ${p.id}</span>
                        <span style="font-size:0.7rem; color:#333; cursor:pointer;" onclick="resetSeat(${p.id})">CLEAR</span>
                    </div>
                    <div class="row">
                        <input type="text" value="${p.name}" onchange="updateName(${p.id}, this.value)" style="font-weight:bold;">
                    </div>
                    <div class="row" style="margin-top:8px;">
                        <button class="secondary" style="flex:1; text-align:left; overflow:hidden; font-size:0.8rem; padding:10px;" onclick="openSearch(${p.id}, false)">
                            ${p.cmd ? p.cmd : '<span style="color:#666">üîç Select Commander...</span>'}
                        </button>
                    </div>
                    ${p.part ? `
                    <div class="row" style="margin-top:5px;">
                        <button class="secondary" style="flex:1; text-align:left; overflow:hidden; font-size:0.8rem; padding:8px;" onclick="openSearch(${p.id}, true)">${p.part}</button>
                        <button style="background:none; color:var(--danger); padding:0 8px;" onclick="clearPart(${p.id})">‚úï</button>
                    </div>` : `
                    <div style="text-align:right; margin-top:5px;">
                        <span style="color:var(--accent); font-size:0.7rem; cursor:pointer; font-weight:bold;" onclick="openSearch(${p.id}, true)">+ PARTNER</span>
                    </div>`}
                `;
                list.appendChild(div);
            });
        }

        function updateName(id, val) { state.players.find(p=>p.id===id).name = val; }
        function resetSeat(id) {
            const p = state.players.find(x=>x.id===id);
            p.name = `Seat ${id}`; p.cmd=""; p.part=""; p.img="";
            renderSeats();
        }
        function clearPart(id) { state.players.find(p=>p.id===id).part = ""; renderSeats(); }

        function openSearch(id, isPart) {
            state.searchTarget = id;
            state.searchIsPartner = isPart;
            document.getElementById('search-bar').value = '';
            document.getElementById('search-results').innerHTML = '';
            document.getElementById('modal-search').classList.add('active');
            document.getElementById('search-bar').focus();
        }
        function onSearchInput(val) {
            if(val.length < 2) return;
            clearTimeout(searchTimer);
            searchTimer = setTimeout(async () => {
                try {
                    const res = await fetch(`https://api.scryfall.com/cards/autocomplete?q=${val}`);
                    const json = await res.json();
                    const div = document.getElementById('search-results');
                    div.innerHTML = '';
                    json.data.forEach(name => {
                        const btn = document.createElement('div');
                        btn.style.padding = '12px';
                        btn.style.borderBottom = '1px solid #333';
                        btn.style.cursor = 'pointer';
                        btn.style.color = '#ccc';
                        btn.innerText = name;
                        btn.onclick = () => fetchCard(name);
                        div.appendChild(btn);
                    });
                } catch(e){}
            }, 300);
        }
        async function fetchCard(name) {
            try {
                const res = await fetch(`https://api.scryfall.com/cards/named?exact=${encodeURIComponent(name)}`);
                const card = await res.json();
                const p = state.players.find(x=>x.id === state.searchTarget);

                if(state.searchIsPartner) p.part = card.name;
                else {
                    p.cmd = card.name;
                    p.img = card.image_uris?.art_crop || card.card_faces?.[0]?.image_uris?.art_crop || "";
                }
                renderSeats();
                closeModal('modal-search');
            } catch(e) { alert("Error loading card"); }
        }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function launchGame() {
            document.getElementById('setup-view').classList.add('hidden');
            document.getElementById('game-view').classList.remove('hidden');
            if(navigator.wakeLock) navigator.wakeLock.request('screen').catch(()=>{});
            buildGrid();
        }

        function buildGrid() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';

            const active = state.players.filter(p => p.active);
            let rows = [];

            if(state.playerCount === 4) { rows = [[active[0], active[1]], [active[2], active[3]]]; }
            else if(state.playerCount === 3) { rows = [[active[0], active[1]], [active[2]]]; }
            else { rows = [[active[0]], [active[1]]]; }

            rows.forEach((rowPlayers) => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'player-row';

                rowPlayers.forEach(p => {
                    const seat = document.createElement('div');
                    seat.className = 'seat';
                    seat.id = `seat-${p.id}`;
                    if(p.img) seat.style.backgroundImage = `url(${p.img})`;

                    const cmdText = p.cmd ? `<div style="font-size:0.7rem; color:#ccc; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:100%;">${p.cmd}</div>` : '';

                    seat.innerHTML = `
                        <div class="seat-overlay"></div>
                        <div class="seat-ui">
                            <div style="text-align:center; width:100%;">
                                <div class="name-tag" style="display:inline-block;">${p.name}</div>
                                ${cmdText}
                            </div>
                            <div class="life-group">
                                <div class="life-btn" onclick="modLife(${p.id}, -1)">-</div>
                                <div class="life-total ${p.life<=10?'danger':''}" id="life-${p.id}">${p.life}</div>
                                <div class="life-btn" onclick="modLife(${p.id}, 1)">+</div>
                            </div>
                            <div class="tools">
                                <button class="tool" onclick="modPoison(${p.id})">‚ò†Ô∏è<div class="counter" id="poi-${p.id}" style="display:none">0</div></button>
                                <button class="tool" onclick="modCast(${p.id})">‚ú®<div class="counter" id="cast-${p.id}" style="display:none">0</div></button>
                                <button class="tool" onclick="preWin(${p.id})">üèÜ</button>
                            </div>
                        </div>
                    `;
                    rowDiv.appendChild(seat);
                });
                grid.appendChild(rowDiv);
            });
        }

        function modLife(id, amt) {
            const p = state.players.find(x=>x.id===id);
            p.life += amt;
            const el = document.getElementById(`life-${id}`);
            el.innerText = p.life;
            el.className = `life-total ${p.life<=10?'danger':''}`;
            if(p.life <= 0) document.getElementById(`seat-${id}`).style.filter = "grayscale(100%)";
        }
        function modPoison(id) {
            const p = state.players.find(x=>x.id===id);
            p.poison++;
            const el = document.getElementById(`poi-${id}`);
            el.innerText = p.poison;
            el.style.display = 'flex';
            if(p.poison >= 10) document.getElementById(`seat-${id}`).style.filter = "grayscale(100%)";
        }
        function modCast(id) {
            const p = state.players.find(x=>x.id===id);
            p.cast++;
            const el = document.getElementById(`cast-${id}`);
            el.innerText = p.cast;
            el.style.display = 'flex';
        }

        // --- FIXED ROLL FUNCTION ---
        function rollFirst() {
            const active = state.players.filter(p => p.active);
            // Clear prev
            active.forEach(p => {
                const el = document.getElementById(`seat-${p.id}`);
                if(el) el.classList.remove('glow-active');
            });

            let i = 0;
            const max = 20;
            const timer = setInterval(() => {
                // Clear all
                active.forEach(p => {
                    const el = document.getElementById(`seat-${p.id}`);
                    if(el) el.classList.remove('glow-active');
                });

                // Highlight random
                const r = Math.floor(Math.random() * active.length);
                const target = document.getElementById(`seat-${active[r].id}`);
                if(target) target.classList.add('glow-active');

                i++;
                if(i > max) clearInterval(timer);
            }, 100);
        }

        function checkWinner() {
            const alive = state.players.filter(p => p.active && p.life > 0 && p.poison < 10);
            if(alive.length === 1) preWin(alive[0].id);
            else if(confirm("Reset Game?")) resetGame();
        }

        function preWin(id) {
            state.winner = state.players.find(x=>x.id===id);
            document.getElementById('winner-name').innerText = state.winner.name + " Wins!";
            document.getElementById('modal-win').classList.add('active');
        }

        async function saveWin(method) {
            closeModal('modal-win');
            if(window.isOnline && window.db) {
                try {
                    await window.dbMethods.addDoc(window.dbMethods.collection(window.db, "groups", state.group, "matches"), {
                        winner: state.winner.name,
                        cmd: state.winner.cmd,
                        method: method,
                        date: window.dbMethods.serverTimestamp()
                    });
                } catch(e){}
            }
            alert("Game Over! " + state.winner.name + " wins.");
            resetGame();
        }

        function resetGame() {
            state.players.forEach(p => { p.life=40; p.poison=0; p.cast=0; });
            document.getElementById('game-view').classList.add('hidden');
            document.getElementById('setup-view').classList.remove('hidden');
        }

        async function showStats() {
            const el = document.getElementById('history-log');
            el.innerHTML = "Loading...";
            document.getElementById('modal-stats').classList.add('active');
            if(!window.isOnline) { el.innerHTML = "Offline Mode - No stats."; return; }

            try {
                const q = window.dbMethods.query(window.dbMethods.collection(window.db, "groups", state.group, "matches"), window.dbMethods.orderBy("date", "desc"), window.dbMethods.limit(10));
                const snap = await window.dbMethods.getDocs(q);
                let html = "";
                if(snap.empty) { el.innerHTML = "No matches found."; return; }

                snap.forEach(d => {
                    const data = d.data();
                    const date = data.date ? new Date(data.date.toDate()).toLocaleDateString() : '';
                    html += `<div style="border-bottom:1px solid #333; padding:8px 0;">
                        <div style="display:flex; justify-content:space-between;">
                            <span style="color:var(--accent); font-weight:bold;">${data.winner}</span>
                            <span style="font-size:0.7rem; color:var(--success);">${data.method}</span>
                        </div>
                        <div style="font-size:0.7rem; color:#666;">${data.cmd || 'No Cmd'} ‚Ä¢ ${date}</div>
                    </div>`;
                });
                el.innerHTML = html;
            } catch(e) { el.innerHTML = "Error loading stats."; }
        }
    </script>
</body>
</html>